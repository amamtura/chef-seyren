# Seyren Apache Virtual Host
#
# Generated by Chef

<VirtualHost <%= node['seyren']['apache_auth']['vhost_interface'] %>:<%= node['seyren']['apache_auth']['vhost_port'] %>>
    ServerName <%= node['seyren']['apache_auth']['vhost_servername'] %>
    <%- if node['seyren']['apache_auth']['vhost_server_aliases'] != nil %>
    ServerAlias <%= node['seyren']['apache_auth']['vhost_server_aliases'] * ' ' %>
    <%- end %>
    RewriteEngine ON
    RewriteRule ^(/.*)$ http://<%= node['ipaddress'] %>:<%= node['tomcat']['port'] %>/seyren$1 [P]

    <Location "/">
            # permit IP or user/pass
            Satisfy Any

            # IP
            # default Order is Deny,Allow
            Deny from all
            Allow from <%= node['ipaddress'] %> 

            # user/pass
            AuthUserFile <%= node['apache']['dir'] %>/users.digest 
            Require valid-user

            # common config 
            AuthType Digest
            AuthName "<%= node['seyren']['apache_auth']['realm'] %>"
            AuthDigestDomain http://<%= node['seyren']['apache_auth']['vhost_servername'] %>/ 
    </Location>

</VirtualHost>
